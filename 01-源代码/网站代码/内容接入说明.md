# Contentlayer 内容接入说明

## 当前状态

✅ Contentlayer 已配置完成
✅ 示例内容文件已创建
⚠️ 需要安装 Contentlayer 依赖

## 安装步骤

### 1. 安装 Contentlayer 依赖

```bash
cd "/Users/luyu/CascadeProjects/Sandy的AI收藏夹/01-源代码/网站代码"
npm install contentlayer next-contentlayer remark-gfm rehype-pretty-code rehype-slug rehype-autolink-headings
```

### 2. 验证安装

```bash
# 类型检查（应该能看到 Contentlayer 生成的类型）
npm run type-check

# 构建测试
npm run build
```

### 3. 查看生成的内容

安装后，Contentlayer 会在 `.contentlayer/generated` 目录生成类型文件。

## 内容目录结构

```
内容/
└── 公开内容/
    ├── 新闻/          # News 类型
    │   └── *.md
    ├── 笔记/          # Note 类型
    │   └── *.md
    └── 页面/          # Page 类型
        └── *.md
```

## Frontmatter 格式

### News 文章

```markdown
---
title: "文章标题"
date: 2025-01-06
tags: [AI, 商业]
score: 9.5
summary: "文章摘要"
---

正文内容...
```

### Note 文章

```markdown
---
title: "笔记标题"
date: 2025-01-06
tags: [生活, 分享]
source: "xiaohongshu"
---

正文内容...
```

### Page 单页

```markdown
---
title: "页面标题"
---

正文内容...
```

## 数据迁移

### 从占位数据切换到 Contentlayer

代码已经支持两种数据源：
1. **占位数据**：如果没有 Contentlayer 数据，使用占位数据
2. **Contentlayer 数据**：如果有内容文件，自动使用 Contentlayer 数据

### 迁移步骤

1. 在 `内容/公开内容/新闻/` 目录添加 Markdown 文件
2. 在 `内容/公开内容/笔记/` 目录添加 Markdown 文件
3. 运行 `npm run build` 生成 Contentlayer 数据
4. 页面会自动使用 Contentlayer 数据

## 注意事项

1. **文件路径**：Contentlayer 配置的路径是 `公开内容/新闻/**/*.md`
2. **Frontmatter**：所有文件必须包含正确的 Frontmatter
3. **图片路径**：图片应放在 `内容/公开内容/附件/` 目录
4. **构建同步**：图片需要同步到 `public/attachments/` 目录

## 图片处理

### 构建前同步脚本

在 `package.json` 中添加：

```json
{
  "scripts": {
    "prebuild": "cp -r 内容/公开内容/附件 public/attachments || true"
  }
}
```

## 故障排查

### 问题 1: Contentlayer 类型未生成

**解决方案**:
```bash
# 清理并重新构建
rm -rf .contentlayer
npm run build
```

### 问题 2: 内容读取失败

**检查**:
- 文件路径是否正确
- Frontmatter 格式是否正确
- 文件是否在正确的目录

### 问题 3: 图片无法显示

**解决方案**:
- 确保图片在 `内容/公开内容/附件/` 目录
- 运行构建前同步脚本
- 使用绝对路径 `/attachments/image.png`



